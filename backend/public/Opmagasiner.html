<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="styles.css">
    <title>Lagerstatus</title>
    <h1>Opmagasiner</h1>
</head>

<body class="Opmagasiner">
    <script type="module">
    </script>
    <a href="main.html" id="logo">
        <picture>Firmalogo</picture>
    </a>
    <div class="Layout" id="LayoutID">
        <div id="Scanning">

            <textbox id="scannedWareTextbox">Senest skannet vare:
            </textbox>
        </div>

        <div class="Button" id="okButton">
            <textbox>Skriv antal og v√¶lg ok:</textbox>
            <input id="opmagasinerAmountInput"></input>
            <button id="amountButton">Ok</button>
            <script>
                document.getElementById("amountButton").addEventListener("click", async () => {

                    const amount = document.getElementById("opmagasinerAmountInput").value;

                    // barcode is either value from manualBarcodeCheck or from scanner ??? bring it up to stand-up.
                    const barcode = document.getElementById("manualInputField").value;
                    const updateWareResult = await updateWare(amount, barcode);

                    // TODO put in function from here...
                    if (updateWareResult === 404) {
                        const tempDiv = document.createElement("div");
                        tempDiv.textContent = "Fejl. Udfyld for at oprette vare:";

                        const barcodeField = createElement("Stregkode");
                        let barcodeInputField = barcodeField.querySelector("input");
                        barcodeInputField.value = `${barcode}`;
                        const nameField = createElement("Navn");
                        const priceField = createElement("Pris");
                        const placementField = createElement("Placering");

                        const makeWareButton = document.createElement("button");
                        makeWareButton.textContent = "Opret vare";
                        makeWareButton.id = "makeWareButton";

                        const parentElement = document.getElementById("LayoutID");
                        parentElement.appendChild(tempDiv);
                        parentElement.appendChild(barcodeField);
                        parentElement.appendChild(nameField);
                        parentElement.appendChild(priceField);
                        parentElement.appendChild(placementField);
                        parentElement.style.gap = "2px";
                        parentElement.appendChild(makeWareButton);
                        document.getElementById("makeWareButton").addEventListener("click", async () => {

                            const makeWareBarcode = barcodeInputField.value;
                            const name = nameField.querySelector("input").value;
                            const quantity = 0;
                            const price = priceField.querySelector("input").value;
                            const placement = placementField.querySelector("input").value;

                            request = { makeWareBarcode, name, quantity, price, placement };
                            const postWareResult = await postWare(request);

                            if (postWareResult === 409) // Ware already exists
                            {
                                tempDiv.textContent = "Fejl. Vare findes allerede.";
                            }
                            else {
                                tempDiv.textContent = "Vare oprettet.";
                                barcodeField.remove();
                                nameField.remove();
                                priceField.remove();
                                placementField.remove();
                                makeWareButton.remove();
                            }
                        })
                    }
                    // ... to here.
                });

            </script>
        </div>

        <div class="Button">
            <textbox>Manuel indtastning: </textbox>
            <input id="manualInputField"></inputid>
            <button id="manualButton">Check</button>
        </div>
        <script>
            document.getElementById("manualButton").addEventListener("click", async () => {
                const barcode = document.getElementById("manualInputField").value;
                const result = await manualBarcodeCheck(barcode);


                const scannedWareTextBox = document.getElementById("scannedWareTextbox");
                scannedWareTextBox.textContent = "Senest skannet vare: ";
                scannedWareTextBox.append(result)
            });
        </script>


    </div>
    <script src="script.js"></script>
</body>
<footer>
    <a href="main.html" id="logo"> <button>Afslut</button>></a>
</footer>

</html>